"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ContainerNode=function(){function e(e){this.domNode=document.getElementById(e),this.data={}}var t=e.prototype;return t.getData=function(e){if(this.data.hasOwnProperty(e))return this.data[e]},t.setData=function(e,t){this.data[e]=t},t.setAttribute=function(e,t){this.domNode&&this.domNode.setAttribute(e,t)},t.addClass=function(e){this.domNode&&(this.domNode.className=[this.domNode.className,e].join(" "))},t.remove=function(){this.domNode&&this.domNode.parent&&this.domNode.parent.removeChild(this.domNode)},e}(),Helpers=function(){function p(){}return p.isObject=function(e,t){var r=typeof e;return e&&("object"===r||!t&&("function"===r||this.isFunction(e)))||!1},p.isString=function(e){return"string"==typeof e},p.isFunction=function(e){return e&&"[object Function]"==={}.toString.call(e)},p.isUndefined=function(e){return void 0===e},p.isNumber=function(e){return"number"==typeof e&&isFinite(e)},p.hasOverlay=function(){return 0<document.getElementsByClassName("has-overlay").length||0<document.querySelectorAll(".nova-has-modal").length},p.getUrlWithoutHash=function(e){var t=e.indexOf("#");return-1===t?e:e.substr(0,t)},p.getCollectQueueCacheKey=function(e){var t=e.split("/").pop().split("?").shift();return!(t.split(".").length<3)&&"dep_"+t},p.loadWidgetScript=function(e,t,r,n){r&&window.checkEntrypoint&&window.checkEntrypoint(e),RGCommons.react.loadWidgetScript(e,t,n)},p.mix=function(e,t,r,n,i,a){var o,d,s,c,l,u;if(!e||!t)return e;if(i){if(2===i&&this.mix(e.prototype,t.prototype,r,n,0,a),d=1===i||3===i?t.prototype:t,u=1===i||4===i?e.prototype:e,!d||!u)return e}else d=t,u=e;var g=r&&!a;if(n)for(s=0,l=n.length;s<l;++s)c=n[s],d.hasOwnProperty(c)&&(o=!g&&c in u,a&&o&&p.isObject(u[c],!0)&&p.isObject(d[c],!0)?this.mix(u[c],d[c],r,null,0,a):!r&&o||(u[c]=d[c]));else for(c in d)d.hasOwnProperty(c)&&(o=!g&&c in u,a&&o&&p.isObject(u[c],!0)&&p.isObject(d[c],!0)?this.mix(u[c],d[c],r,null,0,a):!r&&o||(u[c]=d[c]));return e},p.dedupe=function(e){for(var t,r=e.length,n=Object.create(null),i=[],a=0;a<r;++a)n[t=e[a]]||(n[t]=1,i.push(t));return i},p.later=function(e,t,r,n,i){e=e||0,n=this.isUndefined(n)?[]:n;var a=!1,o=t&&this.isString(r)?t[r]:r,d=function(){a||(o.apply?o.apply(t,n||[]):o(n[0],n[1],n[2],n[3]))},s=i?setInterval(d,e):setTimeout(d,e);return{id:s,interval:i,cancel:function(){a=!0,this.interval?clearInterval(s):clearTimeout(s)}}},p.isRenderableWidget=function(e){return!!this.isObject(e)&&!(!e.id||!e.templateName)},p.initReactData=function(){window.reactData||(window.reactData={widgets:{},initState:{},entryPoints:{},unmount:{}})},p.updateReactStateData=function(e){var t;e&&(p.initReactData(),window.reactData.initState=p.mix(window.reactData.initState,e,!1,null,0,!0),"function"==typeof window.Event?t=new Event("RG.updateReactStateData"):(t=document.createEvent("Event")).initEvent("RG.updateReactStateData",!0,!0),document.dispatchEvent(t))},p.supportsPushState=function(){return!(!window.history||!history.pushState)},p.unmountReactComponent=function(e){var t=self.reactData&&self.reactData.unmount;t&&t[e]&&(t[e](),delete t[e])},p.stringify=function(e,t,r,n){var i,a,o,d;n||(n=[]);var s=t&&t.sep?t.sep:"&",c=t&&t.eq?t.eq:"=",l=!(!t||!t.arrayKey)&&t.arrayKey;if(null===e||this.isUndefined(e)||this.isFunction(e))return r?encodeURIComponent(r)+c:"";if("boolean"!=typeof e&&"[object Boolean]"!==Object.prototype.toString.call(e)||(e=+e),this.isNumber(e)||this.isString(e))return encodeURIComponent(r)+c+encodeURIComponent(e);if(Array.isArray(e)){for(d=[],r=l?r+"[]":r,a=e.length,i=0;i<a;i++)d.push(this.stringify(e[i],t,r,n));return d.join(s)}for(i=n.length-1;0<=i;--i)if(n[i]===e)throw new Error("this.stringify. Cyclical reference");n.push(e),d=[];var u=r?r+"[":"",g=r?"]":"";for(i in e)e.hasOwnProperty(i)&&(o=u+i+g,d.push(this.stringify(e[i],t,o,n)));return n.pop(),!(d=d.join(s))&&r?r+"=":d},p}(),ReactWidgetView=function(){function e(e){this.id=e.id,this.data={widgetId:this.id},this.pageTitle=e.pageTitle,this.pageLayout=e.pageLayout,this.reactWidgetTree=e,this.templateName="reactWrapperTemplate",this.success=!0;var t='<div id="'+this.id+'" class="react-container"></div>';this.template=Hogan.compile(t,{},"reactWrapperTemplate.html"),this._isYUI=!1,this._isReact=!0,this.initializeEventListener()}var t=e.prototype;return t.initializeEventListener=function(){var t=this;window.addEventListener(this.getFullEventName("rendered"),function(){var e=t.container;if(!e)throw new Error("widget: "+t.id+" is not properly implemented. widgetId missing?");t.data.debugInfo&&e.setAttribute("data-debugInfo",t.data.debugInfo);try{t.afterRendered()}catch(e){throw new Error("Error calling afterRendered of widget "+t.id)}})},t.get=function(e){return"container"===e?this.container:null},t.getDefaultDialogConfig=function(){return{}},t.setContainer=function(e){(this.container=e)&&(e.setData("widget",this),e.addClass("js-widgetContainer"))},t.getFullEventName=function(e){return"Widget:"+this.id+":"+e},t.afterRendered=function(){var t=this;widgetRenderer.prepareWidgetTree(this.reactWidgetTree,function(e){widgetLoader.renderReactWidgetTree(e,t.dialog)})},t.render=function(e){widgetRenderer.renderWidget(this,e)},t.fire=function(e){var t,r=this.getFullEventName(e);"function"!=typeof window.CustomEvent?(t=document.createEvent("CustomEvent")).initCustomEvent(r,!1,!1,void 0):t=new CustomEvent(r),window.dispatchEvent(t)},t.once=function(e,t){var r=this.getFullEventName(e);window.addEventListener(r,function e(){t(),window.removeEventListener(r,e,!1)},!1)},e}(),Renderer=function(){function e(){this.renderedWidgets=[],this.loadedStubs=[]}var t=e.prototype;return t.addStub=function(e,t){this.loadedStubs[e]=t},t.renderWidget=function(t,r){var n=this;this.prepareWidgetTree(t,function(e){t.data=e.data,n.renderWidgetTree(t,r)})},t.getStub=function(e){if(!this.loadedStubs[e])throw new Error("Can not get "+e+" since it was not (completely) loaded");return this.loadedStubs[e]},t.addToCollectQueue=function(e,t){var r,n;if(e.yuiModules&&(t.yuiModules=t.yuiModules.concat(e.yuiModules)),e.templateExtensions&&(t.yuiModules=t.yuiModules.concat(e.templateExtensions)),e.template&&"object"==typeof e.template||e._isReact||t.yuiModules.push(e.templateName),Helpers.isObject(e.partials))for(r in e.partials)e.partials.hasOwnProperty(r)&&"string"==typeof(n=e.partials[r])&&t.yuiModules.push(n);t.yuiModules=Helpers.dedupe(t.yuiModules)},t.collectData=function(t,e){var r,n,i=this;if(t&&"object"==typeof t&&!t._isReact)if(t.templateName)for(n in t.toString=function(){r=YRG.rg.WidgetView.getInstance(t);var e="<noscript></noscript>"+i.internalRenderWidget(r);return"application/stubs/AsyncClientSideRenderingWrapper.html"===t.templateName&&r.on("rendered",function(){var e=new ContainerNode(t.id);widgetLoader.loadAndRenderAsyncWidget(e,t.data)}),i.renderedWidgets.push(r),e},this.addToCollectQueue(t,e),t.data)t.data.hasOwnProperty(n)&&(t.data[n]=this.collectData(t.data[n],e));else for(n in t)t.hasOwnProperty(n)&&(t[n]=this.collectData(t[n],e));else if(t&&"object"==typeof t&&t._isReact)for(n in t.toString=function(){r=new ReactWidgetView(t);var e=i.internalRenderWidget(r);return i.renderedWidgets.push(r),e},this.addToCollectQueue(t,e),t.data)t.data.hasOwnProperty(n)&&(t.data[n]=this.collectData(t.data[n],e));return t},t.retrieveData=function(e,t,r){t.yuiModules&&Array.isArray(t.yuiModules)&&0<t.yuiModules.length?YRG.use(t.yuiModules,function(){r&&r(e)}):r&&r(e)},t.prepareWidgetTree=function(e,t){var r={yuiModules:[]};(e=this.collectData(e,r)).collectQueueCacheKey&&lscache.set(e.collectQueueCacheKey,r,2880),this.retrieveData(e,r,function(e){t&&t(e)})},t.callRenderer=function(e,t,r){var n,i,a=this;if(t.hasOwnProperty("replace"))n=YRG.rg.widget.ReplaceRenderer,i=t.replace;else if(t.hasOwnProperty("replaceContent"))n=YRG.rg.widget.ReplaceContentRenderer,i=t.replaceContent;else if(t.hasOwnProperty("append"))n=YRG.rg.widget.AppendRenderer,i=t.append;else if(t.hasOwnProperty("prepend"))n=YRG.rg.widget.PrependRenderer,i=t.prepend;else if(t.hasOwnProperty("beforeNode"))n=YRG.rg.widget.BeforeNodeRenderer,i=t.beforeNode;else if(t.hasOwnProperty("afterNode"))n=YRG.rg.widget.AfterNodeRenderer,i=t.afterNode;else if(t.hasOwnProperty("refresh"))n=YRG.rg.widget.RefreshRenderer,i=t.refresh;else if(t.hasOwnProperty("dialog"))n=YRG.rg.widget.DialogRenderer,i=t.dialog;else if(t.hasOwnProperty("dialogSections"))n=YRG.rg.widget.DialogSectionRenderer,i=t.dialogSections;else if(t.hasOwnProperty("openedDialog"))n=YRG.rg.widget.OpenedDialogRenderer.renderDialog,i=t.openedDialog;else if(t.hasOwnProperty("tooltip"))n=YRG.rg.widget.TooltipRenderer.renderTooltip,i=t.tooltip;else{if(!t.hasOwnProperty("renderer")||"function"!=typeof t.renderer)throw new Error("no valid renderer specified");n=t.renderer,i={}}if(!1===n(e,r,i))return!(this.renderedWidgets=[]);this.renderedWidgets&&Array.isArray(this.renderedWidgets)&&this.renderedWidgets.map(function(e){var t=new ContainerNode(e.id);t&&e.setContainer(t)}),this.renderedWidgets.push(e),"function"==typeof t.afterRendered&&e.once("rendered",function(){t.afterRendered.call(e,e.get("container"))}),"function"==typeof t.after&&!1===t.after.call(e,e.get("container"),YRG.bind(function(){a.checkForRenderEvent()}))||this.checkForRenderEvent()},t.checkForRenderEvent=function(){for(var e;e=this.renderedWidgets.shift();)this.fireRenderEvent(e)},t.fireRenderEvent=function(e){if(!0!==e._isReact){var t=e.get("container");t&&e.fire("rendered",t)}else e.fire("rendered")},t.attachTemplateExtension=function(e,t,r){var n;for(n in window[t])window[t].hasOwnProperty(n)&&(e.hasOwnProperty(n)&&YRG.log("Template data key "+n+" was overwritten by mustache extension function for widget "+r),e[n]=window[t][n]);return e},t.internalRenderWidget=function(t){var e,r,n,i=this,a=t.data;if(YRG.Array.each(t.templateExtensions,function(e){i.attachTemplateExtension(a,e,t.templateName)}),t.template||(e=this.getStub(t.templateName),t.template=this.createHoganTemplate(e.compiledTemplate,e.templateString)),Helpers.isObject(t.partials))for(r in t.partials)t.partials.hasOwnProperty(r)&&"string"==typeof(n=t.partials[r])&&(e=this.getStub(n),t.partials[r]=this.createHoganTemplate(e.compiledTemplate,e.templateString));return t.template.render(a,t.partials)},t.createHoganTemplate=function(e,t){if(!e)throw new Error("Invalid compiled template given");var r=new Function("c","p","i","var tpl = "+e+"; return tpl.call(this, c, p, i);");return new Hogan.Template(r,t,Hogan,{})},t.renderWidgetTree=function(e,t){var r=this,n=YRG.Node.create(this.internalRenderWidget(e));"function"==typeof t.before&&!1===t.before.call(e,n,YRG.bind(function(){r.callRenderer(e,t,n)}))||this.callRenderer(e,t,n)},e}(),widgetRenderer=new Renderer,WidgetLoader=function(){function e(){this.preloadedWidgets=[],"object"==typeof console&&console.log&&(console.log("%cWARNING!","color:white; background:red; font-size: 16pt"),console.log("%cUsing this console may allow attackers to impersonate you and steal your information using an attack called Self-XSS. Do not enter or paste code that you do not understand.","font-size: 14pt")),YRG.use(["rg.WidgetView","rg-widgetloader-renderers","rg-widgetloader-pushstate","rg-tooltip"])}var t=e.prototype;return t.preloadWidget=function(t,r,e,n){var i=this;t=Helpers.getUrlWithoutHash(t),r=r||{};var a=t+JSON.stringify(r);this.preloadedWidgets[a]||n&&"object"==typeof lscache&&lscache.get(n)||(this.preloadedWidgets[a]={state:"loading",keep:!!e},YRG.rg.ajaxDbwAware(t,r,function(e){i.preloadedWidgets[a].widget=e,"render"!==i.preloadedWidgets[a].state?(i.preloadedWidgets[a].state="loaded",e.success&&widgetRenderer.prepareWidgetTree(e.result)):i.loadWidget(t,r,i.preloadedWidgets[a].callback,i.preloadedWidgets[a].context)}))},t.loadWidgetInDialog=function(e,t,r,n,i,a,o,d,s){var c="rg-overlay-dark",l=!1;l=!0===s?(YRG.one("body").addClass(c),!0):(YRG.one("body").removeClass(c),!1),YRG.rg.widget.OverlayCloseable.prototype.initializer=function(){this.afterHostMethod("renderUI",function(){var e=this.get("host"),t=e.get("contentBox"),r=YRG.Node.create('<div class="close"><a class="dialog-close js-dialog-close" href="javascript:" onclick="return false;"></a></div>'),n=r.one(".js-dialog-close");t.setStyle("position","relative"),l?n.setContent('<span class="ico-close-bold-big"></span><span class="ico-close-bold-big-hover"></span>'):n.setContent('<span class="ico-x-close-light"></span>'),t.append(r),n.on("click",e.hide,e)},this)};var u=YRG.rg.widget.OpenedDialogRenderer.createDialog(o,d);this.loadWidget(e,t,function(t){if(!t.success)return u.destroy(),void(Helpers.isFunction(i)?i.call(n,t.errors):YRG.use("rg-header-notify",function(e){return e.rg.notify(t.errors,"warning")}));var e={openedDialog:u,after:r};widgetRenderer.renderWidget(t,e)},n,!1,a)},t.getResultFromDialog=function(t,n,i,a,o){var d=this;return new Promise(function(e,r){o=_objectSpread({},o,{resolve:e,reject:r}),d.loadWidgetInDialog(t,n,null,null,function(e){var t=new Error("Widget failed to load: "+e.join(", "));t.widgetErrors=e,r(t)},i,a,o)})},t.loadWidgetInTooltip=function(e,t,r,n,i,a){var o=YRG.rg.widget.TooltipRenderer.createTooltip(e,t);this.loadWidget(r,n,function(t){if(!t.success)return o.destroy(),void YRG.use("rg-header-notify",function(e){return e.rg.notify(t.errors,"warning")});var e={tooltip:o,after:i};widgetRenderer.renderWidget(t,e)},a)},t.createWidget=function(t,r,n,i){if(Helpers.isRenderableWidget(t)){var a,o=(new Date).getTime(),d=function(e){e.data.renderTime=a-o,e.data.completeRequestTime=e.data.backendTime+e.data.renderTime,Helpers.later(50,null,function(){return RGCommons.monitoring.trackByImage(e.ep,e.data)})},s=function(e){e.once("rendered",function(){return a=(new Date).getTime(),void(Array.isArray(i)?i.map(function(e){d(e)}):d(i))})};Helpers.updateReactStateData(t.state);var e=t.yuiModules;if(e||(e=[]),t.collectQueueCacheKey){var c=lscache.get(t.collectQueueCacheKey);c&&c.yuiModules&&(e=e.concat(c.yuiModules),e=Helpers.dedupe(e))}var l=function(){var e;e=t._isReact?new ReactWidgetView(t):YRG.rg.WidgetView.getInstance(t),i&&s(e),r.call(n,e)};0<e.length?YRG.use(e,l):l()}},t.createWidgetList=function(e,t,r){var n=[],i=[];Array.isArray(e)&&e.map(function(e){Helpers.isRenderableWidget(e)&&(i.push(e),e.yuiModules&&0<e.yuiModules.length&&(n=n.concat(e.yuiModules)))});var a=function(){var e=YRG.rg.getWidgetListViewInstance(i);t.call(r,e)};0<n.length?YRG.use(n,a):a()},t.createInitialWidget=function(e){var t=this;widgetRenderer.prepareWidgetTree(e,function(e){t.attachWidgetTree(e)})},t.loadAndRenderAsyncWidget=function(r,n){if(!r)throw new Error("Missing container for async load of "+n.innerWidgetUrl);if(!(r=r.domNode?YRG.one(r.domNode):r))throw new Error("Missing container for async load of "+n.innerWidgetUrl);this.loadWidget(n.innerWidgetUrl,{},function(e){if(e.success){var t={replace:r,after:function(e){n.hasPlaceHolder&&(e.hide(),YRG.rg.fadeToggle(e,null,{duration:1}))}};widgetRenderer.renderWidget(e,t)}else r.remove(!0)},this,null,"GET",{"X-Rg-AsyncLoad":1},n.innerWidgetCacheKey,n.innerWidgetTTL)},t.loadWidget=function(e,t,r,n,i,a,o,d,s){var c=this;a=a||"GET",e=Helpers.getUrlWithoutHash(e);var l=Helpers.getCollectQueueCacheKey(e);if(l){var u=lscache.get(l);u&&u.yuiModules&&YRG.use(u.yuiModules)}var g=function(e){e.success?(l&&(e.result.collectQueueCacheKey=l),d&&"object"==typeof lscache&&lscache.set(d,e,s),c.createWidget(e.result,r,n,e.tracking)):r.call(n,{render:function(){throw new Error("WidgetError: "+JSON.stringify(e.errors))},success:e.success,errors:e.errors,errorCode:e.result.errorCode,correlationId:e.result.correlationId})};if(d&&"object"==typeof lscache){var p=lscache.get(d);if(p)return void this.createWidget(p.result,r,n,p.tracking)}var f=e+JSON.stringify(t);if(this.preloadedWidgets[f]){var h=this.preloadedWidgets[f];if(Helpers.isString(h.state)&&"loading"===h.state)return this.preloadedWidgets[f].state="render",this.preloadedWidgets[f].callback=r,void(this.preloadedWidgets[f].context=n);if(!h.widget)return;return g(h.widget),void(h.keep||delete this.preloadedWidgets[f])}return YRG.rg.ajaxDbwAware(e,t,g,n,null,a,o)},t.attachWidgetTree=function(e){if(Helpers.updateReactStateData(e.initState),e._isYUI){this.resolveWidgetDataArray(e.data);var t=YRG.one("#"+e.id);if("application/stubs/AsyncClientSideRenderingWrapper.html"===e.templateName)return void this.loadAndRenderAsyncWidget(t,e.data);var r=YRG.rg.WidgetView.getInstance(e);if(!t)return YRG.log('Cannot find container in DOM for widget "'+e.id+'".',"warn"),YRG.log(r),null;r.setContainer(t),r.fire("rendered",t)}else e._isReact&&this.renderReactWidgetTree(e)},t.renderReactWidgetTree=function(e,t){void 0===t&&(t=null),Helpers.initReactData(),this.resolveReactWidgetDataArray(e);var r=e.templateName,n=e.webpackEntryFile,i=e.id;t&&window.reactData.widgets[i]&&(window.reactData.widgets[i].data.dialog=t),Helpers.loadWidgetScript(r,n,!0,function(){window["renderReact_"+r]&&window["renderReact_"+r](i)})},t.resolveReactWidgetDataArray=function(e){var t;if(e&&"object"==typeof e){if(!e._isYUI)for(t in e)e.hasOwnProperty(t)&&(e[t]=this.resolveReactWidgetDataArray(e[t]));if(e.templateName){var r=e.id;return window.reactData.widgets[r]=e,r}}return e},t.resolveWidgetDataArray=function(e){for(var t in e)e.hasOwnProperty(t)&&e[t]&&(e[t].templateName&&(e[t]._isYUI||e[t]._isReact)?this.attachWidgetTree(e[t]):(e[t]instanceof Array||e[t]instanceof Object)&&this.resolveWidgetDataArray(e[t]))},e}(),widgetLoader=new WidgetLoader;